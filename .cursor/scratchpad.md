# Background and Motivation

Шаблон бота требует готовых инфраструктурных модулей, чтобы проекты на его основе могли использовать эти компоненты без изменений. Нужны единые клиенты, слои доступа к БД, пакет повторных попыток и тестовые утилиты.


# Key Challenges and Analysis
- Сохранение простоты и соответствие Clean Architecture.
- Минимальные зависимости и понятный API каждого модуля.
- Единые подходы к конфигурированию и логированию.
- Возможность лёгкого использования в тестах.

# High-level Task Breakdown
1. Добавить health‑check и readiness‑endpoint.
   - Успех: HTTP-маршруты `/healthz` и `/readyz` проверяют состояние сервиса и зависят от модулей хранения.
2. Создать тестовые хелперы.
   - Успех: пакет `pkg/testutils` предоставляет контексты, моковые логгеры и утилиты проверок для использования в тестах.

# Current Status / Progress Tracking


# Project Status Board
- [ ] Health‑check и readiness‑endpoint
- [ ] Тестовые хелперы

# Executor's Feedback or Assistance Requests
_(пусто)_

# Lessons
- Не полагаться на жёсткие sleep в тестах конкурентных компонентов, лучше использовать require.Eventually/Assert.Never.
- Не стоит привязывать юнит-тесты к реальному сетевому стеку: используем кастомный RoundTripper, чтобы гарантировать повторяемые ошибки и счётчики попыток.
- При форматировании времени для HTTP-заголовков (`http.TimeFormat`) всегда использовать `.UTC()`, так как формат жестко задает "GMT", но `Format` не конвертирует часовой пояс автоматически.
- При тестировании компонентов, пишущих в файлы (как `lumberjack`), необходимо гарантировать закрытие файлов (через `Close`) перед чтением их содержимого в тесте, иначе возможны ошибки доступа ("used by another process").
- `slog.Handler` не имеет метода `Close`. Если нужно закрывать ресурсы (файлы), следует предусмотреть механизм (например, возвращать функцию очистки или использовать глобальный реестр для тестов).
